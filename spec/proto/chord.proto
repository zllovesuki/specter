syntax = "proto3";
package protocol;

option optimize_for = SPEED;
option go_package = "kon.nect.sh/specter/spec/protocol";

import "spec/proto/node.proto";

message IdentityRequest {}

message IdentityResponse {
    Node identity = 1;
}

message PingRequest {}

message PingResponse {}

message NotifyRequest {
    Node predecessor = 1;
}

message NotifyResponse {}

message FindSuccessorRequest {
    uint64 key = 1;
}

message FindSuccessorResponse {
    Node successor = 1;
}

message GetPredecessorRequest {}

message GetPredecessorResponse {
    Node predecessor = 1;
}

message GetSuccessorsRequest {}

message GetSuccessorsResponse {
    repeated Node successors = 1;
}

enum MembershipChangeOperation {
    UNKNOWN_CHANGE = 0;
    JOIN_REQUEST = 1;
    JOIN_FINISH = 2;
    LEAVE_REQUEST = 3;
    LEAVE_FINISH = 4;
}

message MembershipChangeRequest {
    MembershipChangeOperation op = 1;
    // used by RequestToJoin
    Node joiner = 2;
    // used by RequestToLeave
    Node leaver = 3;
    // used by both JoinFinish and LeaveFinish
    bool stablize = 4;
    bool release = 5;
}

message MembershipChangeResponse {
    Node predecessor = 1;
    repeated Node successors = 2;
}
